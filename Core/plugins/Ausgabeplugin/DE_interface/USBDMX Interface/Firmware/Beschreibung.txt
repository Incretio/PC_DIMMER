Informationen zu den erweiterten Funktionen der USB DMX Interface Firmware, Version: 1.10
-----------------------------------------------------------------------------------------

In diesem Ordner befindet sich die Firmware Version 1.1 für das Interface. Sie kann mittlerweile als stabil angesehen werden und ist daher die aktuelle Version für das Interface. In den drei Unterordnern finden sich in den entsprechenden Formaten assemblierte Hex-Dateien. Im folgenden sind noch einige Informationen zusammengestellt, welche die Erweiterungen zur Version 1.0 beschreiben. Beachten Sie bitte vorallem den letzten Abschnitt bzgl. der Programmierung der Firmware:

Nachdem einige User von Problemen mit diversen DMX Geräten berichteten wurde dieses Problem näher analysiert. Es stellte sich heraus, dass diese Geräte leider nicht 100% DMX konform sind und daher mit dem schnellen DMX Timing der Originalfirmware Probleme haben.
Diese neue Firmware Version enthält stark erweiterte Möglichkeiten zur Kontrolle der Timingparameter des DMX Transmitters. Im Detail sind das:
- Breaktime: Markiert den Beginn eines neuen DMX Frames (auch bekannt unter dem Namen "Reset"). Einstellbereich: 5,3us-349,5ms, Schrittweite: 5,333us, Default: 17(96us)
- Marktime: Zeit zwischen Break und Startbyte. Einstellbereich: 0.67us-43,6ms, Schrittweite: 0,666us, Default: 13(9us)
- Interbytetime: Zeit zwischen den Datenbytes (beginnt erst nach der Übertragung der zwei Stoppbits). Einstellbereich: 0.67us-43,6ms, Schrittweite: 0,666us, Default: 0(0,67us)
- Interframetime: Zeit zwischen dem letzten Datenbyte und Break. Einstellbereich: 21,3us-1398ms, Schrittweite: 21,333us, Default: 0(21,3us)`
- Channelcount: Anzahl der zu übertragenden DMX Kanäle. Einstellbereich: 0-512, Schrittweite: 1, Default: 512
- Startbyte: Wert des zu übermittelnden Startbytes. Einstellbereich: 0-255, Schrittweite: 1, Default: 0
- Control: Ermöglicht es die Verwendung von Interbytetime und Interframetime komplett abzuschalten. Das sollte zumindest theoretisch zu weniger Jitter auf der DMX Leitung führen. Bit 0 = 1: Enable Interbytedelay, Bit 1 = 1: Enable Interframedelay, Default: 0
Alle Timingkontrollen garantieren nur, dass der eingestellte Wert nicht unterschritten wird. Aufgrund von Interrupt-Routinen für die USB Kommunikation kann es hin und wieder passieren, dass ein Delay einige us länger als angegeben dauert. Auch stimmen die Angaben noch nicht auf die Mikrosekunde, zum genauen Messen war noch keine Zeit.
Zum Übermitteln dieser Parameter an das Interface wird die neue DLL-Funktion SetInterfaceAdvTxConfig (siehe usbdmx.txt) verwendet, welche sich in der ebenfalls auf Version 1.10 erweiterten usbdmx.dll findet. Diese ist abwärtskompatibel mit der Original-DLL und auch die originale Firmware funktioniert mit der neuen DLL. Mit Hilfe der Funktion StoreInterfaceAdvTxConfig ist es möglich die übermittelten Parameter dauerhaft im EEPROM des Interface zu speichern, sie werden dann beim Start automatisch geladen. Auf diese weise ist es Möglich, das Interface mit neuen Timingparametern mit Programmen zu betreiben, die das direkte Setzten dieser Werte (noch) nicht unterstützten.
Weiterhin enthält die DLL nun eine Funktion um die Version des angeschlossenen Interface zu ermitteln (GetDeviceVersion) und so zu entscheiden, ob das angeschlossene Interface die hier beschriebenen, erweiterten Funktionen unterstützt. Der Rückgabewert ist ein 16 Bit Wert, bei dem das Highbyte die Major Version und das Lowbyte die Minor Version angibt. Die originale Interfacefirmware liefert v1.00. Außerdem gibt es mit Hilfe der ebenfalls neuen Funktion RegisterInputChangeBlockNotification alternativ zu RegisterInputChangeNotification die Möglichkeit bei einem Inputchange Callback zu erfahren, in welchem Bereich des DMX Universe Kanäle verändert wurden. Die Blocknummer (0-15) gibt dabei die Nummer des 32er Kanalblocks an, in dem eine Änderung stattfand. Wird z.B. der 32. Kanal verändert, hat die Blocknummer den Wert 1 während er beim 31. Kanal den Wert 0 besitzt. Es können beliebig viele Kanäle innerhalb des Blocks ihren Wert verändert haben.
Zum Testen und Einstellen der neuen Features wurde auch das Testprogramm erweitert.
Es soll hier noch einmal darauf hingewiesen werden, dass diese neue Firmwareversion im wesentlichen dazu gedacht ist, Probleme mit einigen wenigen Geräten zu lösen, die das DMX Protokoll nicht ganz so genau nehmen und möglicherweise Entwicklern von DMX Empfängern eine Hilfe zum Testen ihrer Geräte anzubieten. Wenn eine Lichtanlage mit der Originalfirmware ohne Probleme funktioniert, gibt es keinen Grund die Firmware upzudaten.
Die Seriennummer des Interface wird wie üblich im Assemblercode geändert. Die mitgelieferte .epp Datei enthält eine Kopie des EEPROMs mit dem Timing der originalen Firmwareversion, so dass das Interface gleich beim ersten Start mit dem richtigen Timing arbeitet. Beim Flashen der Firmware bitte auch die Fuse BODEN aktivieren (ist in fuses.jpg nicht aktiviert!), ansonsten könnte der EEPROM Inhalt beim Ausschalten beschädigt werden und das Interface startet das nächste Mal mit einer falschen Konfiguration.

Stand 05.03.2007
(c) 2006 Michael Dreschmann
info@digital-enlightenment.de
www.digital-enlightenment.de